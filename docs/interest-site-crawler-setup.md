# 兴趣站点爬虫模块使用指南

## 1. 数据库迁移

首先执行 SQL 脚本创建必要的表：

```bash
# 开发环境
psql $DATABASE_URL -f sql/add_interest_site_crawler_tables.sql

# 或直接在数据库管理工具中执行
```

然后同步 Prisma schema：

```bash
npm run db:sync
```

## 2. 环境变量配置

在 `.env.local` 文件中添加 DeepSeek API Key：

```bash
DEEPSEEK_API_KEY=your_deepseek_api_key_here
```

获取 DeepSeek API Key：
1. 访问 https://platform.deepseek.com/
2. 注册/登录账号
3. 在 API Keys 页面创建新的 API Key
4. 复制到 `.env.local` 文件

## 3. 功能说明

### 3.1 站点管理

- **查看站点列表**：显示所有从"发现站点"添加的站点
- **分组管理**：创建分组，将站点归类
- **站点筛选**：按分组筛选站点

### 3.2 HTML 结构分析

- **自动分析**：点击"分析HTML"按钮，系统会：
  1. 获取站点 HTML
  2. 调用 DeepSeek AI 分析结构
  3. 自动生成爬虫配置
  4. 保存配置到数据库

- **分析状态**：
  - `pending`: 未分析
  - `analyzing`: 分析中
  - `success`: 分析成功，已生成配置
  - `failed`: 分析失败

### 3.3 爬虫执行

- **今日爬虫**：爬取当天的新闻
- **时间段爬虫**：指定开始和结束日期爬取（待实现）

### 3.4 爬虫结果

- **结果展示**：查看所有爬取的新闻
- **分组标签页**：按站点分组查看结果
- **时间筛选**：按时间范围筛选结果

## 4. 使用流程

1. **添加站点**：
   - 在"发现站点"页面搜索
   - 点击"加入候选"添加站点

2. **分析站点**：
   - 进入"兴趣站点爬虫"页面
   - 找到要分析的站点
   - 点击"分析HTML"按钮
   - 等待分析完成（通常需要 10-30 秒）

3. **执行爬虫**：
   - 分析成功后，点击"今日爬虫"
   - 系统会在后台执行爬虫任务
   - 结果会自动保存

4. **查看结果**：
   - 切换到"爬虫结果"标签页
   - 查看所有爬取的新闻

## 5. 注意事项

1. **DeepSeek API 费用**：分析 HTML 会消耗 API 调用次数，请注意费用
2. **分析准确性**：AI 分析可能不完美，建议检查生成的配置
3. **爬虫频率**：避免过于频繁的爬虫，遵守网站的 robots.txt
4. **错误处理**：如果分析失败，可以查看错误信息，手动调整配置

## 6. 待完善功能

- [ ] 时间段爬虫 UI
- [ ] 爬虫结果详细页面
- [ ] 配置手动编辑
- [ ] 爬虫任务状态监控
- [ ] 批量操作（批量分析、批量爬虫）

## 7. 故障排除

### 问题：分析失败

**可能原因**：
- DeepSeek API Key 未配置或无效
- 网站需要登录或反爬虫
- HTML 结构过于复杂

**解决方法**：
1. 检查 `.env.local` 中的 `DEEPSEEK_API_KEY`
2. 查看错误信息
3. 尝试手动配置

### 问题：爬虫无结果

**可能原因**：
- 配置不正确
- 网站结构已变化
- 需要特殊请求头

**解决方法**：
1. 重新分析站点
2. 检查生成的配置
3. 手动调整配置

