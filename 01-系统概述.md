# 新闻热点聚合系统 - 系统概述

**版本**: v4.0.0  
**文档版本**: 1.0  
**最后更新**: 2025-01-XX

---

## 1. 系统概述

### 1.1 项目背景

新闻热点聚合系统是一个多平台新闻热点监控、筛选、分析和推送系统。系统通过聚合11+主流平台的热点新闻，结合用户自定义的关键词筛选和智能权重算法，为用户提供精准、及时的热点推送服务。

### 1.2 系统目标

- **多平台聚合**: 支持知乎、微博、抖音、B站、百度、今日头条等11+平台
- **智能筛选**: 基于关键词的精准内容筛选
- **智能排序**: 多维度权重算法重新排序热点
- **多渠道推送**: 支持飞书、钉钉、企业微信、Telegram、邮件、ntfy等6种推送渠道
- **AI分析**: 基于MCP协议的AI对话式数据分析
- **Web管理界面**: 提供现代化的Web管理界面，支持配置管理和数据可视化
- **灵活部署**: 支持Vercel、Docker、自托管等多种部署方式

### 1.3 技术栈

#### 1.3.1 前端技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 框架 | Next.js 14+ | React全栈框架，支持SSR/SSG |
| UI框架 | React 18+ | 用户界面库 |
| 样式方案 | Tailwind CSS | 原子化CSS框架 |
| 组件库 | shadcn/ui | 高质量React组件库 |
| 状态管理 | Zustand / React Query | 客户端状态管理和服务端状态 |
| 表单处理 | React Hook Form + Zod | 表单验证和处理 |
| 数据可视化 | Recharts / Chart.js | 图表展示 |
| 日期处理 | date-fns | 日期格式化 |

#### 1.3.2 后端技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 运行时 | Node.js 18+ | JavaScript运行时 |
| API框架 | Next.js API Routes | 服务端API路由 |
| 数据库 | Neon PostgreSQL | Serverless PostgreSQL数据库 |
| ORM | Prisma | 类型安全的数据库ORM |
| HTTP客户端 | fetch / axios | HTTP请求库 |
| 定时任务 | Vercel Cron / node-cron | 定时任务调度 |
| 配置管理 | dotenv + Zod | 环境变量和配置验证 |

#### 1.3.3 数据存储

| 类型 | 技术选型 | 说明 |
|------|---------|------|
| 主数据库 | Neon PostgreSQL | Serverless PostgreSQL，自动扩缩容 |
| 缓存 | Vercel KV / Redis | 缓存热点数据 |
| 文件存储 | Vercel Blob / S3 | 存储HTML报告和附件 |

#### 1.3.4 部署与运维

| 类型 | 技术选型 | 说明 |
|------|---------|------|
| 部署平台 | Vercel | Next.js首选部署平台 |
| 容器化 | Docker | 容器化部署 |
| CI/CD | GitHub Actions | 自动化构建和部署 |
| 监控 | Vercel Analytics | 性能监控 |
| 日志 | Vercel Logs | 日志管理 |

#### 1.3.5 开发工具

| 类型 | 技术选型 | 说明 |
|------|---------|------|
| 语言 | TypeScript | 类型安全的JavaScript |
| 包管理 | pnpm / npm | 包管理器 |
| 代码格式化 | Prettier | 代码格式化 |
| 代码检查 | ESLint | 代码质量检查 |
| 类型检查 | TypeScript | 静态类型检查 |

### 1.4 系统边界

**系统包含**:
- 新闻数据爬取和存储
- 关键词匹配与筛选
- 权重计算与排序
- HTML报告生成
- 多渠道通知推送
- Web管理界面（配置管理、数据可视化、历史查询）
- MCP AI分析服务（可选）
- RESTful API接口

**系统不包含**:
- 新闻内容详情爬取（仅标题和链接）
- 用户认证与授权（单用户系统）
- 多租户支持
- 移动端App

### 1.5 架构模式

#### 1.5.1 整体架构模式

采用 **Next.js全栈架构**，前后端一体化：

- **前端**: Next.js App Router + React Server Components
- **后端**: Next.js API Routes + Server Actions
- **数据库**: Neon PostgreSQL（Serverless）
- **部署**: Vercel（Serverless Functions）

#### 1.5.2 数据流架构

```
外部API → Next.js API Route → Prisma ORM → Neon PostgreSQL
                                              ↓
Web界面 ← Next.js Server Component ← Prisma ORM ← Neon PostgreSQL
```

#### 1.5.3 核心优势

1. **全栈TypeScript**: 前后端类型共享，减少错误
2. **Serverless架构**: 自动扩缩容，按需付费
3. **现代化UI**: 响应式设计，优秀的用户体验
4. **实时数据**: Server Components提供实时数据展示
5. **易于部署**: Vercel一键部署，零配置

---

## 2. 系统功能模块

### 2.1 数据采集模块

- **功能**: 定时爬取11+平台热点新闻
- **技术**: Next.js API Routes + 定时任务
- **存储**: Neon PostgreSQL数据库

### 2.2 数据处理模块

- **功能**: 关键词匹配、权重计算、排序
- **技术**: Next.js Server Actions
- **存储**: Neon PostgreSQL数据库

### 2.3 报告生成模块

- **功能**: 生成HTML报告、格式化消息
- **技术**: Next.js Server Components + 模板引擎
- **存储**: Neon PostgreSQL + Vercel Blob

### 2.4 通知推送模块

- **功能**: 多渠道消息推送
- **技术**: Next.js API Routes
- **集成**: 飞书、钉钉、企业微信、Telegram、邮件、ntfy

### 2.5 Web管理界面

- **功能**: 配置管理、数据可视化、历史查询
- **技术**: Next.js App Router + React Server Components
- **UI**: Tailwind CSS + shadcn/ui

### 2.6 MCP AI分析服务（可选）

- **功能**: AI对话式数据分析
- **技术**: FastMCP 2.0
- **集成**: 通过MCP协议与AI客户端交互

---

## 3. 技术选型理由

### 3.1 为什么选择Next.js？

1. **全栈能力**: 前后端一体化，减少项目复杂度
2. **Server Components**: 服务端组件，减少客户端JavaScript
3. **API Routes**: 内置API路由，无需单独后端服务
4. **优秀性能**: 自动代码分割、图片优化、SSR/SSG
5. **Vercel集成**: 完美集成Vercel平台，一键部署
6. **TypeScript支持**: 原生TypeScript支持，类型安全

### 3.2 为什么选择Neon数据库？

1. **Serverless**: 自动扩缩容，按需付费
2. **PostgreSQL兼容**: 标准PostgreSQL，功能完整
3. **分支功能**: 支持数据库分支，方便开发测试
4. **全球分布**: 多区域部署，低延迟
5. **免费额度**: 提供免费额度，适合个人项目
6. **易于集成**: 与Vercel完美集成

### 3.3 为什么选择Prisma？

1. **类型安全**: 自动生成TypeScript类型
2. **迁移管理**: 版本化数据库迁移
3. **查询构建器**: 直观的查询API
4. **关系处理**: 优雅的关系处理
5. **开发体验**: 优秀的开发工具和文档

---

## 4. 项目结构预览

```
newsFocus-hf/
├── app/                      # Next.js App Router
│   ├── (dashboard)/         # 仪表板路由组
│   │   ├── page.tsx         # 首页
│   │   ├── news/            # 新闻列表页
│   │   ├── analytics/       # 数据分析页
│   │   └── settings/        # 设置页
│   ├── api/                 # API Routes
│   │   ├── crawl/           # 爬取接口
│   │   ├── news/            # 新闻查询接口
│   │   ├── notify/          # 通知推送接口
│   │   └── config/          # 配置管理接口
│   └── layout.tsx           # 根布局
├── components/              # React组件
│   ├── ui/                  # shadcn/ui组件
│   ├── news/                # 新闻相关组件
│   ├── charts/              # 图表组件
│   └── forms/               # 表单组件
├── lib/                     # 工具库
│   ├── db/                  # 数据库相关
│   │   └── prisma.ts        # Prisma客户端
│   ├── services/            # 业务服务
│   │   ├── crawler.ts       # 爬虫服务
│   │   ├── matcher.ts       # 关键词匹配
│   │   ├── calculator.ts    # 权重计算
│   │   └── notifier.ts      # 通知推送
│   └── utils/               # 工具函数
├── prisma/                  # Prisma配置
│   ├── schema.prisma        # 数据库模型
│   └── migrations/          # 数据库迁移
├── public/                  # 静态资源
├── types/                   # TypeScript类型定义
├── config/                  # 配置文件
│   ├── config.yaml          # 主配置（可选）
│   └── frequency_words.txt  # 关键词配置
└── mcp_server/              # MCP服务器（可选）
    └── ...
```

---

## 5. 开发环境要求

### 5.1 必需环境

- **Node.js**: >= 18.0.0
- **pnpm**: >= 8.0.0 (推荐) 或 npm >= 9.0.0
- **PostgreSQL**: >= 14.0 (本地开发，生产使用Neon)
- **Git**: >= 2.0.0

### 5.2 推荐工具

- **VS Code**: 代码编辑器
- **Prisma Extension**: VS Code扩展，数据库管理
- **Postman / Insomnia**: API测试工具
- **Docker**: 本地数据库容器化（可选）

### 5.3 环境变量

```env
# 数据库
DATABASE_URL="postgresql://user:password@host:5432/dbname"

# Next.js
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# 通知配置（可选）
FEISHU_WEBHOOK_URL=""
DINGTALK_WEBHOOK_URL=""
TELEGRAM_BOT_TOKEN=""
TELEGRAM_CHAT_ID=""
EMAIL_FROM=""
EMAIL_PASSWORD=""
EMAIL_SMTP_SERVER=""
EMAIL_SMTP_PORT=""
NTFY_SERVER_URL="https://ntfy.sh"
NTFY_TOPIC=""
NTFY_TOKEN=""

# 其他配置
ENABLE_MCP_SERVER="false"
```

---

## 6. 快速开始

### 6.1 安装依赖

```bash
pnpm install
```

### 6.2 配置数据库

```bash
# 复制环境变量文件
cp .env.example .env

# 编辑.env文件，配置DATABASE_URL

# 运行数据库迁移
pnpm prisma migrate dev

# 生成Prisma客户端
pnpm prisma generate
```

### 6.3 启动开发服务器

```bash
pnpm dev
```

访问 http://localhost:3000

### 6.4 构建生产版本

```bash
pnpm build
pnpm start
```

---

## 7. 文档导航

- [02-架构设计.md](./02-架构设计.md) - 详细架构设计
- [03-核心模块设计.md](./03-核心模块设计.md) - 核心模块设计
- [04-数据模型设计.md](./04-数据模型设计.md) - 数据库模型设计
- [05-接口设计.md](./05-接口设计.md) - API接口设计
- [06-流程设计.md](./06-流程设计.md) - 业务流程设计
- [07-部署架构.md](./07-部署架构.md) - 部署方案
- [08-安全设计.md](./08-安全设计.md) - 安全设计
- [09-性能设计.md](./09-性能设计.md) - 性能优化
- [10-扩展性设计.md](./10-扩展性设计.md) - 扩展性设计

