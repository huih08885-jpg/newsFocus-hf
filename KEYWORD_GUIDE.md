# 关键词功能使用指南

## 📋 关键词的作用

关键词系统是新闻热点聚合系统的核心功能之一，主要作用包括：

### 1. **智能筛选新闻** 🎯
   - 从海量新闻中自动筛选出你关心的内容
   - 只关注包含特定关键词的新闻，节省时间

### 2. **自动分类标记** 🏷️
   - 匹配的新闻会自动打上关键词组标签
   - 方便按主题分类查看和管理

### 3. **权重计算** ⚖️
   - 匹配的新闻会计算权重分数
   - 权重越高，说明新闻越重要或越热门
   - 可以按权重排序，优先查看重要新闻

### 4. **推送通知** 🔔
   - 可以基于关键词匹配推送相关新闻
   - 及时收到你关心的热点信息

### 5. **数据分析** 📊
   - 统计各关键词组的匹配情况
   - 分析哪些主题最热门

## 🔍 关键词的三种类型

### 1. **普通词（words）**
- **作用**：标题包含任意一个普通词即匹配
- **示例**：`["AI", "人工智能", "机器学习"]`
- **匹配规则**：标题包含 "AI" **或** "人工智能" **或** "机器学习" 即匹配

**示例**：
```
普通词: AI, 人工智能, 机器学习

✅ 匹配: "华为发布新款AI手机"
✅ 匹配: "人工智能技术突破"
✅ 匹配: "机器学习算法优化"
❌ 不匹配: "今日天气晴朗"
```

### 2. **必须词（requiredWords，以+开头）**
- **作用**：标题必须包含所有必须词才能匹配
- **格式**：以 `+` 开头，如 `+手机`、`+芯片`
- **示例**：`["+手机", "+芯片"]`
- **匹配规则**：标题必须同时包含 "手机" **和** "芯片"

**示例**：
```
普通词: 华为, 苹果
必须词: +手机, +芯片

✅ 匹配: "华为发布新款手机，搭载自研芯片"
✅ 匹配: "苹果手机芯片性能提升"
❌ 不匹配: "华为发布新款手机" (缺少"芯片")
❌ 不匹配: "苹果芯片性能提升" (缺少"手机")
❌ 不匹配: "华为发布新款电脑" (不包含"手机")
```

### 3. **过滤词（excludedWords，以!开头）**
- **作用**：标题包含过滤词则排除，不匹配
- **格式**：以 `!` 开头，如 `!水果`、`!价格`
- **示例**：`["!水果", "!价格"]`
- **匹配规则**：即使包含普通词，但如果包含过滤词则不匹配

**示例**：
```
普通词: 苹果
过滤词: !水果, !价格

✅ 匹配: "苹果公司发布新款iPhone"
✅ 匹配: "苹果手机销量创新高"
❌ 不匹配: "苹果水果价格下跌" (包含"水果")
❌ 不匹配: "苹果手机价格公布" (包含"价格")
```

## 🎯 完整匹配流程

匹配算法按以下顺序执行：

```
1. 检查普通词匹配
   ↓ (如果包含任意一个普通词)
2. 检查必须词匹配
   ↓ (如果存在必须词，必须全部包含)
3. 检查过滤词
   ↓ (如果包含过滤词，则排除)
4. 匹配成功 ✓
```

## 📝 如何使用

### 步骤 1: 访问关键词配置页面

1. 点击左侧导航栏的 **"设置"**
2. 选择 **"关键词"** 子菜单
3. 或直接访问：`/settings/keywords`

### 步骤 2: 创建关键词组

1. 点击 **"添加关键词组"** 按钮
2. 填写表单：
   - **词组名称**（可选）：如 "AI 人工智能"
   - **普通词**：每行一个，如：
     ```
     AI
     人工智能
     机器学习
     深度学习
     ```
   - **必须词**（可选）：每行一个，以 `+` 开头，如：
     ```
     +手机
     +芯片
     ```
   - **过滤词**（可选）：每行一个，以 `!` 开头，如：
     ```
     !水果
     !价格
     ```
   - **优先级**：数字越小优先级越高（0 最高）
   - **状态**：启用/禁用

3. 点击 **"保存"**

### 步骤 3: 测试关键词组

1. 在关键词组列表中，点击 **"测试"** 按钮
2. 输入测试文本（新闻标题）
3. 查看匹配结果：
   - ✅ 绿色：匹配成功，显示匹配到的词语
   - ❌ 红色：匹配失败，显示失败原因

### 步骤 4: 运行爬取任务

1. 创建关键词组后，点击 **"立即爬取"**
2. 系统会自动：
   - 爬取各平台新闻
   - 匹配关键词
   - 计算权重
   - 保存匹配结果

### 步骤 5: 查看匹配结果

1. 访问 **"新闻列表"** 页面
2. 匹配的新闻会显示：
   - 关键词组标签
   - 权重分数
   - 匹配次数

3. 可以按关键词组筛选：
   - 在筛选栏选择关键词组
   - 只显示匹配该词组的新闻

## 💡 实际应用场景

### 场景 1: 关注 AI 相关新闻

**关键词组配置**：
```
名称: AI 人工智能
普通词:
  AI
  人工智能
  机器学习
  深度学习
  大模型
  神经网络
优先级: 0
```

**效果**：
- 自动筛选所有包含 AI、人工智能等关键词的新闻
- 按权重排序，优先查看热门 AI 新闻

### 场景 2: 关注手机芯片新闻

**关键词组配置**：
```
名称: 手机芯片
普通词:
  华为
  苹果
  小米
  高通
  联发科
必须词:
  +手机
  +芯片
优先级: 1
```

**效果**：
- 只匹配同时包含"手机"和"芯片"的新闻
- 避免匹配到不相关的新闻（如"苹果水果"）

### 场景 3: 关注科技新闻但排除价格信息

**关键词组配置**：
```
名称: 科技新闻（不含价格）
普通词:
  科技
  技术
  创新
  产品
过滤词:
  !价格
  !售价
  !多少钱
优先级: 2
```

**效果**：
- 匹配科技相关新闻
- 自动排除价格相关的新闻

### 场景 4: 关注特定公司动态

**关键词组配置**：
```
名称: 华为动态
普通词:
  华为
  Huawei
必须词:
  +华为
过滤词:
  !水果
优先级: 0
```

**效果**：
- 精确匹配华为相关新闻
- 排除"苹果"等可能误匹配的词

## 📊 权重计算说明

匹配的新闻会计算权重分数，权重由以下因素决定：

1. **排名权重（60%）**
   - 排名越靠前（数字越小），权重越高
   - 例如：排名 #1 的新闻权重 > 排名 #10 的新闻

2. **频次权重（30%）**
   - 新闻出现次数越多，权重越高
   - 同一新闻在不同时间出现，权重会增加

3. **热度权重（10%）**
   - 高排名出现的次数占比
   - 经常出现在前几名的新闻权重更高

**权重示例**：
- 权重 85.5：高权重，重要新闻
- 权重 50.0：中等权重
- 权重 20.0：低权重

## 🔧 高级技巧

### 1. **优先级设置**
- 数字越小，优先级越高
- 优先级高的词组会先匹配
- 一条新闻可能匹配多个词组，但会优先使用高优先级的标签

### 2. **组合使用三种关键词**
```
普通词: 苹果, 华为
必须词: +手机
过滤词: !水果, !价格

匹配示例：
✅ "苹果手机发布新品" (包含"苹果"和"手机"，不包含过滤词)
✅ "华为手机销量增长" (包含"华为"和"手机"，不包含过滤词)
❌ "苹果水果价格下跌" (包含过滤词"水果"和"价格")
❌ "苹果公司财报" (缺少必须词"手机")
```

### 3. **禁用关键词组**
- 如果暂时不需要某个关键词组，可以禁用它
- 禁用的词组不会参与匹配
- 可以随时重新启用

### 4. **测试功能**
- 创建关键词组后，务必使用测试功能验证
- 测试多个不同的标题，确保匹配逻辑正确
- 根据测试结果调整关键词配置

## ❓ 常见问题

### Q1: 为什么我的关键词组没有匹配到新闻？

**可能原因**：
1. 关键词拼写错误
2. 必须词设置太严格
3. 过滤词排除了所有匹配
4. 还没有运行爬取任务

**解决方案**：
1. 使用测试功能验证关键词组
2. 检查关键词拼写
3. 调整必须词和过滤词
4. 运行爬取任务

### Q2: 一条新闻可以匹配多个关键词组吗？

**可以**。一条新闻可以同时匹配多个关键词组，系统会：
- 为每个匹配的词组创建匹配记录
- 显示所有匹配的词组标签
- 可以按任意一个关键词组筛选

### Q3: 如何提高匹配精度？

**建议**：
1. 使用必须词缩小匹配范围
2. 使用过滤词排除不相关内容
3. 设置合理的优先级
4. 定期测试和调整关键词

### Q4: 关键词匹配是实时的吗？

**不是**。关键词匹配在爬取任务完成后执行：
1. 爬取新闻 → 保存到数据库
2. 匹配关键词 → 创建匹配记录
3. 计算权重 → 更新匹配记录

### Q5: 如何查看匹配统计？

访问 **"数据分析"** 页面，可以查看：
- 各关键词组的匹配数量
- 平均权重
- 匹配趋势

## 🎓 最佳实践

1. **从简单开始**：先创建简单的关键词组，逐步优化
2. **使用测试功能**：创建后立即测试，确保匹配正确
3. **定期调整**：根据实际匹配结果调整关键词
4. **合理设置优先级**：重要主题设置高优先级（小数字）
5. **组合使用**：结合普通词、必须词、过滤词实现精确匹配

## 📚 相关文档

- `PLATFORM_CRAWLER_STATUS.md` - 平台爬虫状态
- `CRAWLER_ARCHITECTURE.md` - 爬虫架构说明
- `PLATFORM_DATA_TROUBLESHOOTING.md` - 问题排查指南

