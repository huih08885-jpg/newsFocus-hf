# 完整工作流程指南

## 🎯 系统核心功能

根据你的理解，系统应该实现：
1. ✅ **定时爬虫** - 根据关键词定时爬取相关信息
2. ✅ **分类展示** - 按关键词组分类展示新闻
3. ✅ **深层次分析** - 发现规律和现象
4. ✅ **趋势追踪** - 追踪关键词热度变化

## 📋 完整工作流程

### 第一步：配置关键词组

1. 访问 `/settings/keywords`
2. 创建关键词组，例如：
   ```
   名称: 电商
   普通词: 电商, 国外, 国内, 销售量大, 热销
   必须词: (可选)
   过滤词: (可选)
   优先级: 0
   状态: 启用
   ```
3. 使用"测试"功能验证关键词组

### 第二步：定时爬虫（自动执行）

**系统已配置定时任务**：
- ⏰ **每6小时自动爬取一次**（`vercel.json` 中配置）
- 📍 定时任务路径：`/api/cron/crawl`
- 🔄 自动执行流程：
  1. 爬取所有启用的平台
  2. 自动匹配关键词
  3. 计算权重
  4. 保存到数据库

**手动触发爬取**：
- 访问首页或 `/platforms` 页面
- 点击"立即爬取"按钮

### 第三步：分类展示

#### 3.1 按关键词组查看新闻

1. 访问 `/news` 页面（新闻列表）
2. 在筛选栏选择关键词组（如"电商"）
3. 只显示匹配该关键词组的新闻
4. 每条新闻显示：
   - ✅ 关键词组标签
   - ✅ 权重分数
   - ✅ 匹配次数
   - ✅ 平台来源
   - ✅ 爬取时间

#### 3.2 多平台热点展示

1. 访问 `/platforms` 页面
2. 查看各平台最新热点
3. 匹配的新闻会显示关键词组标签

### 第四步：深层次分析

#### 4.1 总体数据分析

访问 `/analytics` 页面，查看：

**总体统计**：
- 📊 总新闻数
- 📊 匹配新闻数
- 📊 匹配率
- 📊 平均权重

**平台分布**：
- 📈 各平台新闻占比（饼图）
- 📈 各平台匹配数量

**关键词统计**：
- 📊 各关键词组匹配数量（柱状图）
- 📊 各关键词组平均权重

**趋势分析**：
- 📈 最近7天的新闻数量趋势
- 📈 匹配数量变化趋势

#### 4.2 关键词组趋势分析

访问 `/analytics/trends` 页面（如果存在），或通过API：

```bash
GET /api/analytics/trends?keywordGroupId=xxx&dateFrom=2025-01-01&dateTo=2025-01-15&granularity=day
```

**分析维度**：
- 📈 **时间趋势**：按天/周/月查看匹配数量变化
- 📈 **权重趋势**：查看平均权重变化
- 📈 **平台分布**：哪些平台该关键词更热门
- 📈 **热度周期**：发现关键词热度的周期性规律

#### 4.3 发现规律和现象

**通过数据分析可以发现**：

1. **热度趋势**：
   - 哪些关键词组在上升？
   - 哪些关键词组在下降？
   - 是否有周期性规律？

2. **平台特征**：
   - 哪些平台更关注某个主题？
   - 不同平台的热点差异？

3. **权重分析**：
   - 高权重新闻的特征？
   - 哪些关键词组更容易产生高权重新闻？

4. **时间规律**：
   - 一天中什么时间热点最多？
   - 一周中哪几天热点最多？
   - 是否有季节性规律？

## 🔄 自动化流程

### 完整自动化流程

```
1. 定时任务触发（每6小时）
   ↓
2. 爬取所有平台新闻
   ↓
3. 自动匹配关键词组
   ↓
4. 计算权重分数
   ↓
5. 保存到数据库
   ↓
6. 数据可用于：
   - 分类展示（新闻列表）
   - 数据分析（分析页面）
   - 趋势追踪（趋势分析）
   - 通知推送（可选）
```

### 定时任务配置

当前配置（`vercel.json`）：
```json
{
  "crons": [
    {
      "path": "/api/cron/crawl",
      "schedule": "0 */6 * * *"  // 每6小时执行一次
    }
  ]
}
```

**修改定时频率**：
- `0 */6 * * *` - 每6小时
- `0 */3 * * *` - 每3小时
- `0 * * * *` - 每小时
- `0 9,15,21 * * *` - 每天9点、15点、21点

## 📊 数据分析示例

### 示例1：电商关键词分析

**场景**：分析"电商"关键词的热度变化

1. **查看总体统计**：
   - 访问 `/analytics`
   - 选择日期范围
   - 查看"电商"关键词组的匹配数量

2. **查看趋势**：
   - 使用趋势分析API
   - 查看最近30天的匹配数量变化
   - 发现是否有周期性规律

3. **平台分析**：
   - 查看哪些平台"电商"新闻最多
   - 分析不同平台的关注点差异

4. **权重分析**：
   - 查看"电商"关键词组的平均权重
   - 识别高权重新闻的特征

### 示例2：发现热点规律

**场景**：发现AI相关新闻的热度周期

1. **配置关键词组**：
   ```
   名称: AI人工智能
   普通词: AI, 人工智能, 机器学习, 深度学习
   ```

2. **收集数据**：
   - 等待定时任务执行（或手动爬取）
   - 收集至少1周的数据

3. **分析趋势**：
   - 访问 `/analytics`
   - 查看趋势图表
   - 发现AI新闻在哪些时间段更热门

4. **得出结论**：
   - 例如：AI新闻在工作日更热门
   - 例如：AI新闻在上午10点和下午3点达到高峰

## 🎯 最佳实践

### 1. 关键词组配置

- ✅ **从简单开始**：先创建简单的关键词组
- ✅ **逐步优化**：根据匹配结果调整关键词
- ✅ **使用测试功能**：创建后立即测试
- ✅ **合理设置优先级**：重要主题设置高优先级

### 2. 数据分析

- ✅ **定期查看**：每天查看分析页面
- ✅ **对比分析**：对比不同时间段的数据
- ✅ **关注趋势**：重点关注趋势变化
- ✅ **发现规律**：记录发现的规律和现象

### 3. 定时任务

- ✅ **确保运行**：确认定时任务正常执行
- ✅ **监控日志**：定期检查爬取日志
- ✅ **调整频率**：根据需求调整爬取频率

## 📈 高级分析功能

### 1. 自定义分析

通过API可以自定义分析：

```bash
# 获取特定关键词组的趋势
GET /api/analytics/trends?keywordGroupId=xxx&dateFrom=2025-01-01&dateTo=2025-01-15&granularity=day

# 获取特定平台的统计
GET /api/analytics?platforms=zhihu,weibo&dateFrom=2025-01-01&dateTo=2025-01-15

# 获取特定关键词组的统计
GET /api/analytics?keywordGroupId=xxx&dateFrom=2025-01-01&dateTo=2025-01-15
```

### 2. 数据导出

- 访问 `/analytics` 页面
- 点击"导出数据"按钮（开发中）
- 导出CSV或JSON格式数据

### 3. 通知推送

配置通知后，系统可以：
- 📧 定时推送分析报告
- 📧 推送高权重新闻
- 📧 推送趋势变化提醒

## 🔍 问题排查

### Q: 定时任务没有执行？

**检查**：
1. 确认 `vercel.json` 配置正确
2. 确认部署到 Vercel（定时任务只在 Vercel 上运行）
3. 检查 Vercel Cron Jobs 页面

### Q: 没有匹配到新闻？

**检查**：
1. 确认关键词组已启用
2. 确认有新闻数据（运行爬取）
3. 确认执行了匹配（手动或自动）
4. 使用测试功能验证关键词组

### Q: 分析数据不准确？

**检查**：
1. 确认数据时间范围正确
2. 确认匹配记录已创建
3. 确认筛选条件正确

## 📚 相关文档

- `KEYWORD_GUIDE.md` - 关键词功能使用指南
- `KEYWORD_TROUBLESHOOTING.md` - 关键词问题排查
- `QUICK_START_KEYWORDS.md` - 快速开始指南

