# 更新日志

## [4.2.0] - 2024-12-05

### 🗑️ 功能移除

#### 移除数据分析模块
- 移除了数据分析页面 (`/analytics`)
- 移除了趋势分析页面 (`/analytics/trends`)
- 移除了数据分析相关的 API 端点
- 简化了仪表板，移除了统计卡片和图表展示
- 保留了基本的新闻列表展示功能

#### 移除情感分析模块
- 移除了情感分析页面 (`/analytics/sentiment`)
- 移除了情感分析服务 (`lib/services/sentiment.ts`)
- 从爬虫服务中移除了情感分析功能
- 移除了情感预警通知功能
- 移除了新闻详情页中的情感倾向显示

#### 移除个性化推荐模块
- 移除了个性化推荐页面 (`/recommendations`)
- 移除了推荐服务 (`lib/services/recommender.ts`)
- 移除了收藏功能页面 (`/collections`)
- 移除了用户行为记录功能
- 移除了相关新闻推荐功能
- 从新闻详情页移除了收藏按钮和相关新闻组件

### ✨ 功能优化

- **简化仪表板**：专注于展示最新新闻，移除了复杂的数据分析图表
- **代码精简**：移除了大量未使用的代码，提高了代码可维护性
- **性能优化**：减少了不必要的数据库查询和计算

### 📝 说明

本次更新主要目的是简化系统功能，专注于核心的新闻爬取、展示和管理功能。移除的功能模块不会影响以下核心功能：
- ✅ 新闻爬虫功能
- ✅ 新闻列表和详情展示
- ✅ 关键词匹配
- ✅ 站点发现和管理
- ✅ 兴趣站点爬虫
- ✅ RSS订阅
- ✅ 历史查询
- ✅ 设置功能

---

## [4.1.0] - 2024-12-05

### 🎉 新功能

#### 兴趣站点爬虫模块
- **站点管理**：支持从"发现站点"模块添加站点到兴趣站点爬虫
- **HTML 分析**：集成 DeepSeek AI 自动分析 HTML 结构，生成爬虫配置
- **智能爬虫**：支持今日爬虫和按时间段爬虫
- **分组管理**：支持对站点进行分组管理，便于分类查看
- **爬虫结果展示**：
  - 支持按分组标签页查看结果
  - 支持按站点、分组、日期范围筛选
  - 支持分页浏览

### ✨ 功能优化

#### 爬虫功能增强
- **编码处理**：支持 GBK/GB2312 编码自动检测和转换，解决中文乱码问题
- **智能选择器回退**：当原始选择器失效时，自动尝试常见的选择器模式
- **内容过滤优化**：
  - 自动过滤导航链接、侧边栏等非文章内容
  - 智能识别并移除导航元素（nav, header, footer, aside 等）
  - 过滤导航关键词和链接密集的文本块
- **HTML 结构分析**：当选择器失败时，自动分析 HTML 结构并推荐可用选择器

#### 爬虫结果展示优化
- **发布时间显示**：显示具体发布时间（YYYY-MM-DD HH:mm），不再使用相对时间
- **内容展开/收起**：支持长内容展开/收起，默认显示前3段
- **段落格式保留**：保留文章原有段落结构，提升阅读体验
- **排序优化**：按发布时间倒序排列，最新文章优先显示

### 🐛 问题修复

- 修复了 UUID 类型不匹配导致的数据库查询错误
- 修复了编码转换导致的标题乱码问题
- 修复了选择器匹配失败时的错误处理
- 修复了内容提取时包含导航和侧边栏内容的问题

### 🔧 技术改进

- 采用 Database First 工作流，简化数据库 schema 管理
- 优化了 HTML 解析和内容提取逻辑
- 增强了错误处理和日志记录
- 改进了编码检测和转换机制

### 📦 依赖更新

- 新增 `iconv-lite` 和 `@types/iconv-lite` 用于编码转换

---

## [4.0.0] - 之前版本

（历史版本记录...）

